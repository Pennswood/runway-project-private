import json
from pathlib import Path

from loguru import logger
import numpy as np
import pandas as pd
from sklearn.metrics import log_loss
import typer

# REPO_ROOT = Path(__file__).parents[1]

app = typer.Typer(add_completion=False)


#@app.command()
def main():
    """Computes the mean-aggregated log loss for a set of predictions given some test labels."""
    predictions = pd.read_csv("./prediction.csv")
    training_labels = pd.read_csv("./data/open_train_labels.csv.bz2", compression="bz2")
    #airport_scores = {
    #    airport: log_loss(
    #        labels.loc[labels.airport == airport].active,
    #        predictions.loc[predictions.airport == airport].active,
    #        eps=1e-16,
    #    )
    #    for airport in sorted(labels.airport.unique())
    #}
    #logger.info("Airport scores:\n{}", json.dumps(airport_scores, indent=2))
    #score = np.mean(list(airport_scores.values()))
    #logger.success(f"Score: {score}")
    scores = [
        log_loss(group["active"], predictions.loc[group.index, "active"])
        for airport, group in training_labels.groupby("airport")
    ]
    print(scores)

if __name__ == "__main__":
    main()

def reg_hyper_output_to_key(a):
a = [[[0.1, 15, 0.012827107467716972], [0.1, 7.5, 0.03034380858845281], [0.1, 3.5, 0.048039959815295866], [0.25, 4.5, 0.04746820457201385], [0.1, 1.5, 0.06750003022140949], [0.1, 2.0, 0.056714218580424546], [0.25, 1.5, 0.07860435060431968], [0.1, 1.0, 0.07763039193215514], [0.1, 1.0, 0.08256280486628258], [0.1, 0.5, 0.08243858365349828], [0.1, 0.5, 0.08914492076675005], [0.1, 1.0, 0.100760812843948]], [[0.25, 14, 0.04574629385392288], [0.1, 4.5, 0.07653471045487728], [0.25, 5.0, 0.08604715882955592], [0.1, 2.5, 0.11058332070827255], [0.25, 2.0, 0.1303221574506315], [0.25, 1.5, 0.15121919448037693], [0.1, 1.0, 0.15581065682630574], [0.1, 0.5, 0.15722633952704118], [0.25, 1.0, 0.17802706314524072], [0.1, 0.5, 0.18144883501833514], [0.25, 0.5, 0.19943118618489367], [0.1, 0.5, 0.1817780184855386]], [[0.5, 12, 0.025169467472367316], [0.5, 2.0, 0.06609384178218936], [0.25, 1.5, 0.07081415930938523], [0.1, 1.0, 0.07890610065466859], [0.5, 1.0, 0.08487285089866362], [0.75, 1.0, 0.09943910050542225], [0.25, 0.5, 0.09329195370986383], [0.25, 0.5, 0.0946828619137796], [1, 1.0, 0.09707476880425547], [0.5, 0.5, 0.09973471617819818], [0.5, 0.5, 0.09958974459711169], [0.5, 0.5, 0.0996074167664695]], [[0.1, 15, 0.015101438902596858], [1, 11, 0.043632195007558806], [0.25, 4.5, 0.0513888201987064], [0.5, 3.0, 0.07154350331294941], [0.25, 2.5, 0.0690000996423807], [0.25, 1.5, 0.09267072031693854], [0.25, 1.5, 0.0851163296569588], [0.5, 1.5, 0.09209686018822227], [0.1, 1.0, 0.09416337275467347], [0.25, 0.5, 0.11843294115559616], [0.25, 0.5, 0.12158397642374273], [0.25, 0.5, 0.1096280938186088]], [[0.1, 15, 0.026619490335662317], [0.1, 9.0, 0.050504062005151014], [0.1, 5.0, 0.0713601124927621], [0.1, 3.5, 0.08805007351137381], [0.25, 5.5, 0.07386493500472424], [0.25, 4.0, 0.09694814142068903], [0.1, 2.0, 0.12021291656308608], [0.25, 3.0, 0.11479656496723399], [0.1, 1.5, 0.13401918572292507], [0.25, 2.0, 0.1349782600671132], [0.1, 1.0, 0.14810869781345803], [0.25, 1.5, 0.14697763727077245]], [[0.75, 15, 0.03077448555866715], [0.1, 2.0, 0.07469354784786719], [0.1, 2.0, 0.07196468160088262], [0.1, 1.0, 0.09540216034773999], [0.1, 0.5, 0.10531533516906448], [0.1, 0.5, 0.10656772099564069], [0.1, 0.5, 0.12329296594894355], [0.5, 0.5, 0.12721135860615787], [0.1, 0.5, 0.11949293595720929], [1, 0.5, 0.13058436667256348], [0.75, 0.5, 0.13968395663582245], [0.1, 0.0, 0.12464415152587664]], [[0.25, 15, 0.02278261261070167], [0.25, 5.0, 0.04895615055533363], [0.1, 3.0, 0.05572831769094007], [0.25, 3.0, 0.06702446364579666], [0.25, 2.5, 0.07013730068513448], [0.25, 1.5, 0.08397721917362477], [0.25, 1.5, 0.08512130761263532], [0.25, 1.5, 0.09282191460069969], [0.25, 1.0, 0.0918618954327951], [0.25, 0.5, 0.10426189531128274], [0.1, 1.0, 0.09490479791336535], [0.25, 0.5, 0.11141959059770565]], [[0.25, 5.5, 0.037248973306756694], [0.1, 1.5, 0.06626104611602922], [0.25, 1.5, 0.07546671186679799], [0.25, 1.0, 0.08407657657126942], [0.25, 0.5, 0.09078741721271297], [0.1, 0.5, 0.08768203773277194], [0.25, 0.5, 0.10198276040290681], [0.1, 0.5, 0.08950394129223753], [0.25, 0.5, 0.09429264917381665], [0.25, 0.5, 0.10222609709129236], [0.25, 0.5, 0.09721492747486608], [0.5, 0.5, 0.10147191548742811]], [[0.1, 13, 0.021837178561675788], [0.25, 5.0, 0.059224930212378464], [0.1, 4.0, 0.04986804550049401], [0.1, 2.5, 0.06524095893816062], [0.1, 1.5, 0.07572049244501251], [0.1, 1.0, 0.09844723272110904], [0.1, 1.0, 0.09196609259721172], [0.1, 1.0, 0.09179836126346395], [0.1, 0.5, 0.09657873377924148], [0.25, 0.5, 0.11606923270709357], [0.25, 0.5, 0.12090223410190014], [0.1, 0.5, 0.11774022237165187]], [[0.1, 15, 0.018914205485892382], [0.25, 12, 0.0394283955446655], [0.1, 6.5, 0.05037380708705508], [0.1, 3.5, 0.07494314606811764], [0.1, 3.0, 0.07761232538943318], [0.1, 2.0, 0.09901857996366296], [0.25, 2.5, 0.10356808028370565], [0.1, 2.0, 0.08671545842236356], [0.1, 1.5, 0.10810156606143835], [0.1, 1.5, 0.12531006764540337], [0.1, 1.0, 0.1069445909862925], [0.1, 1.0, 0.11281226522470464]]]
airports = ["katl","kclt","kden","kdfw","kjfk","kmem","kmia","kord","kphx","ksea"]
lookahead=range(30,390,30)
b = dict()
for i in range(len(a)):
    for j in range(len(a[i])):
        b[(airports[i],lookahead[j])] = a[i][j][:2]

    print(b)

def reg_hyper_output_to_key_regularized_V1(a):
a = [[[0.1, 15, 0.012827107467716972], [0.1, 7.5, 0.03034380858845281], [0.1, 3.5, 0.048039959815295866], [0.25, 4.5, 0.04746820457201385], [0.1, 1.5, 0.06750003022140949], [0.1, 2.0, 0.056714218580424546], [0.25, 1.5, 0.07860435060431968], [0.1, 1.0, 0.07763039193215514], [0.1, 1.0, 0.08256280486628258], [0.1, 0.5, 0.08243858365349828], [0.1, 0.5, 0.08914492076675005], [0.1, 1.0, 0.100760812843948]], [[0.25, 14, 0.04574629385392288], [0.1, 4.5, 0.07653471045487728], [0.25, 5.0, 0.08604715882955592], [0.1, 2.5, 0.11058332070827255], [0.25, 2.0, 0.1303221574506315], [0.25, 1.5, 0.15121919448037693], [0.1, 1.0, 0.15581065682630574], [0.1, 0.5, 0.15722633952704118], [0.25, 1.0, 0.17802706314524072], [0.1, 0.5, 0.18144883501833514], [0.25, 0.5, 0.19943118618489367], [0.1, 0.5, 0.1817780184855386]], [[0.5, 12, 0.025169467472367316], [0.5, 2.0, 0.06609384178218936], [0.25, 1.5, 0.07081415930938523], [0.1, 1.0, 0.07890610065466859], [0.5, 1.0, 0.08487285089866362], [0.75, 1.0, 0.09943910050542225], [0.25, 0.5, 0.09329195370986383], [0.25, 0.5, 0.0946828619137796], [1, 1.0, 0.09707476880425547], [0.5, 0.5, 0.09973471617819818], [0.5, 0.5, 0.09958974459711169], [0.5, 0.5, 0.0996074167664695]], [[0.1, 15, 0.015101438902596858], [1, 11, 0.043632195007558806], [0.25, 4.5, 0.0513888201987064], [0.5, 3.0, 0.07154350331294941], [0.25, 2.5, 0.0690000996423807], [0.25, 1.5, 0.09267072031693854], [0.25, 1.5, 0.0851163296569588], [0.5, 1.5, 0.09209686018822227], [0.1, 1.0, 0.09416337275467347], [0.25, 0.5, 0.11843294115559616], [0.25, 0.5, 0.12158397642374273], [0.25, 0.5, 0.1096280938186088]], [[0.1, 15, 0.026619490335662317], [0.1, 9.0, 0.050504062005151014], [0.1, 5.0, 0.0713601124927621], [0.1, 3.5, 0.08805007351137381], [0.25, 5.5, 0.07386493500472424], [0.25, 4.0, 0.09694814142068903], [0.1, 2.0, 0.12021291656308608], [0.25, 3.0, 0.11479656496723399], [0.1, 1.5, 0.13401918572292507], [0.25, 2.0, 0.1349782600671132], [0.1, 1.0, 0.14810869781345803], [0.25, 1.5, 0.14697763727077245]], [[0.75, 15, 0.03077448555866715], [0.1, 2.0, 0.07469354784786719], [0.1, 2.0, 0.07196468160088262], [0.1, 1.0, 0.09540216034773999], [0.1, 0.5, 0.10531533516906448], [0.1, 0.5, 0.10656772099564069], [0.1, 0.5, 0.12329296594894355], [0.5, 0.5, 0.12721135860615787], [0.1, 0.5, 0.11949293595720929], [1, 0.5, 0.13058436667256348], [0.75, 0.5, 0.13968395663582245], [0.1, 0.0, 0.12464415152587664]], [[0.25, 15, 0.02278261261070167], [0.25, 5.0, 0.04895615055533363], [0.1, 3.0, 0.05572831769094007], [0.25, 3.0, 0.06702446364579666], [0.25, 2.5, 0.07013730068513448], [0.25, 1.5, 0.08397721917362477], [0.25, 1.5, 0.08512130761263532], [0.25, 1.5, 0.09282191460069969], [0.25, 1.0, 0.0918618954327951], [0.25, 0.5, 0.10426189531128274], [0.1, 1.0, 0.09490479791336535], [0.25, 0.5, 0.11141959059770565]], [[0.25, 5.5, 0.037248973306756694], [0.1, 1.5, 0.06626104611602922], [0.25, 1.5, 0.07546671186679799], [0.25, 1.0, 0.08407657657126942], [0.25, 0.5, 0.09078741721271297], [0.1, 0.5, 0.08768203773277194], [0.25, 0.5, 0.10198276040290681], [0.1, 0.5, 0.08950394129223753], [0.25, 0.5, 0.09429264917381665], [0.25, 0.5, 0.10222609709129236], [0.25, 0.5, 0.09721492747486608], [0.5, 0.5, 0.10147191548742811]], [[0.1, 13, 0.021837178561675788], [0.25, 5.0, 0.059224930212378464], [0.1, 4.0, 0.04986804550049401], [0.1, 2.5, 0.06524095893816062], [0.1, 1.5, 0.07572049244501251], [0.1, 1.0, 0.09844723272110904], [0.1, 1.0, 0.09196609259721172], [0.1, 1.0, 0.09179836126346395], [0.1, 0.5, 0.09657873377924148], [0.25, 0.5, 0.11606923270709357], [0.25, 0.5, 0.12090223410190014], [0.1, 0.5, 0.11774022237165187]], [[0.1, 15, 0.018914205485892382], [0.25, 12, 0.0394283955446655], [0.1, 6.5, 0.05037380708705508], [0.1, 3.5, 0.07494314606811764], [0.1, 3.0, 0.07761232538943318], [0.1, 2.0, 0.09901857996366296], [0.25, 2.5, 0.10356808028370565], [0.1, 2.0, 0.08671545842236356], [0.1, 1.5, 0.10810156606143835], [0.1, 1.5, 0.12531006764540337], [0.1, 1.0, 0.1069445909862925], [0.1, 1.0, 0.11281226522470464]]]
airports = ["katl","kclt","kden","kdfw","kjfk","kmem","kmia","kord","kphx","ksea"]
lookahead=range(30,390,30)
b = dict()
for i in range(len(a)):
    for j in range(len(a[i])):
        if a[i][j][0] < .25:
            a[i][j][0] = .25
        b[(airports[i],lookahead[j])] = a[i][j][:2]

print(b)

def reg_hyper_output_to_key_regularized_V2(a):
a = [[[0.1, 15, 0.012827107467716972], [0.1, 7.5, 0.03034380858845281], [0.1, 3.5, 0.048039959815295866], [0.25, 4.5, 0.04746820457201385], [0.1, 1.5, 0.06750003022140949], [0.1, 2.0, 0.056714218580424546], [0.25, 1.5, 0.07860435060431968], [0.1, 1.0, 0.07763039193215514], [0.1, 1.0, 0.08256280486628258], [0.1, 0.5, 0.08243858365349828], [0.1, 0.5, 0.08914492076675005], [0.1, 1.0, 0.100760812843948]], [[0.25, 14, 0.04574629385392288], [0.1, 4.5, 0.07653471045487728], [0.25, 5.0, 0.08604715882955592], [0.1, 2.5, 0.11058332070827255], [0.25, 2.0, 0.1303221574506315], [0.25, 1.5, 0.15121919448037693], [0.1, 1.0, 0.15581065682630574], [0.1, 0.5, 0.15722633952704118], [0.25, 1.0, 0.17802706314524072], [0.1, 0.5, 0.18144883501833514], [0.25, 0.5, 0.19943118618489367], [0.1, 0.5, 0.1817780184855386]], [[0.5, 12, 0.025169467472367316], [0.5, 2.0, 0.06609384178218936], [0.25, 1.5, 0.07081415930938523], [0.1, 1.0, 0.07890610065466859], [0.5, 1.0, 0.08487285089866362], [0.75, 1.0, 0.09943910050542225], [0.25, 0.5, 0.09329195370986383], [0.25, 0.5, 0.0946828619137796], [1, 1.0, 0.09707476880425547], [0.5, 0.5, 0.09973471617819818], [0.5, 0.5, 0.09958974459711169], [0.5, 0.5, 0.0996074167664695]], [[0.1, 15, 0.015101438902596858], [1, 11, 0.043632195007558806], [0.25, 4.5, 0.0513888201987064], [0.5, 3.0, 0.07154350331294941], [0.25, 2.5, 0.0690000996423807], [0.25, 1.5, 0.09267072031693854], [0.25, 1.5, 0.0851163296569588], [0.5, 1.5, 0.09209686018822227], [0.1, 1.0, 0.09416337275467347], [0.25, 0.5, 0.11843294115559616], [0.25, 0.5, 0.12158397642374273], [0.25, 0.5, 0.1096280938186088]], [[0.1, 15, 0.026619490335662317], [0.1, 9.0, 0.050504062005151014], [0.1, 5.0, 0.0713601124927621], [0.1, 3.5, 0.08805007351137381], [0.25, 5.5, 0.07386493500472424], [0.25, 4.0, 0.09694814142068903], [0.1, 2.0, 0.12021291656308608], [0.25, 3.0, 0.11479656496723399], [0.1, 1.5, 0.13401918572292507], [0.25, 2.0, 0.1349782600671132], [0.1, 1.0, 0.14810869781345803], [0.25, 1.5, 0.14697763727077245]], [[0.75, 15, 0.03077448555866715], [0.1, 2.0, 0.07469354784786719], [0.1, 2.0, 0.07196468160088262], [0.1, 1.0, 0.09540216034773999], [0.1, 0.5, 0.10531533516906448], [0.1, 0.5, 0.10656772099564069], [0.1, 0.5, 0.12329296594894355], [0.5, 0.5, 0.12721135860615787], [0.1, 0.5, 0.11949293595720929], [1, 0.5, 0.13058436667256348], [0.75, 0.5, 0.13968395663582245], [0.1, 0.0, 0.12464415152587664]], [[0.25, 15, 0.02278261261070167], [0.25, 5.0, 0.04895615055533363], [0.1, 3.0, 0.05572831769094007], [0.25, 3.0, 0.06702446364579666], [0.25, 2.5, 0.07013730068513448], [0.25, 1.5, 0.08397721917362477], [0.25, 1.5, 0.08512130761263532], [0.25, 1.5, 0.09282191460069969], [0.25, 1.0, 0.0918618954327951], [0.25, 0.5, 0.10426189531128274], [0.1, 1.0, 0.09490479791336535], [0.25, 0.5, 0.11141959059770565]], [[0.25, 5.5, 0.037248973306756694], [0.1, 1.5, 0.06626104611602922], [0.25, 1.5, 0.07546671186679799], [0.25, 1.0, 0.08407657657126942], [0.25, 0.5, 0.09078741721271297], [0.1, 0.5, 0.08768203773277194], [0.25, 0.5, 0.10198276040290681], [0.1, 0.5, 0.08950394129223753], [0.25, 0.5, 0.09429264917381665], [0.25, 0.5, 0.10222609709129236], [0.25, 0.5, 0.09721492747486608], [0.5, 0.5, 0.10147191548742811]], [[0.1, 13, 0.021837178561675788], [0.25, 5.0, 0.059224930212378464], [0.1, 4.0, 0.04986804550049401], [0.1, 2.5, 0.06524095893816062], [0.1, 1.5, 0.07572049244501251], [0.1, 1.0, 0.09844723272110904], [0.1, 1.0, 0.09196609259721172], [0.1, 1.0, 0.09179836126346395], [0.1, 0.5, 0.09657873377924148], [0.25, 0.5, 0.11606923270709357], [0.25, 0.5, 0.12090223410190014], [0.1, 0.5, 0.11774022237165187]], [[0.1, 15, 0.018914205485892382], [0.25, 12, 0.0394283955446655], [0.1, 6.5, 0.05037380708705508], [0.1, 3.5, 0.07494314606811764], [0.1, 3.0, 0.07761232538943318], [0.1, 2.0, 0.09901857996366296], [0.25, 2.5, 0.10356808028370565], [0.1, 2.0, 0.08671545842236356], [0.1, 1.5, 0.10810156606143835], [0.1, 1.5, 0.12531006764540337], [0.1, 1.0, 0.1069445909862925], [0.1, 1.0, 0.11281226522470464]]]
airports = ["katl","kclt","kden","kdfw","kjfk","kmem","kmia","kord","kphx","ksea"]
lookahead=range(30,390,30)
b = dict()
for i in range(len(a)):
    for j in range(len(a[i])):
        if a[i][j][1] > 10:
            a[i][j][1] = 10
        b[(airports[i],lookahead[j])] = a[i][j][:2]

print(b)

def reg_hyper_output_to_key_regularized_V2(a):
a = [[[0.1, 15, 0.012827107467716972], [0.1, 7.5, 0.03034380858845281], [0.1, 3.5, 0.048039959815295866], [0.25, 4.5, 0.04746820457201385], [0.1, 1.5, 0.06750003022140949], [0.1, 2.0, 0.056714218580424546], [0.25, 1.5, 0.07860435060431968], [0.1, 1.0, 0.07763039193215514], [0.1, 1.0, 0.08256280486628258], [0.1, 0.5, 0.08243858365349828], [0.1, 0.5, 0.08914492076675005], [0.1, 1.0, 0.100760812843948]], [[0.25, 14, 0.04574629385392288], [0.1, 4.5, 0.07653471045487728], [0.25, 5.0, 0.08604715882955592], [0.1, 2.5, 0.11058332070827255], [0.25, 2.0, 0.1303221574506315], [0.25, 1.5, 0.15121919448037693], [0.1, 1.0, 0.15581065682630574], [0.1, 0.5, 0.15722633952704118], [0.25, 1.0, 0.17802706314524072], [0.1, 0.5, 0.18144883501833514], [0.25, 0.5, 0.19943118618489367], [0.1, 0.5, 0.1817780184855386]], [[0.5, 12, 0.025169467472367316], [0.5, 2.0, 0.06609384178218936], [0.25, 1.5, 0.07081415930938523], [0.1, 1.0, 0.07890610065466859], [0.5, 1.0, 0.08487285089866362], [0.75, 1.0, 0.09943910050542225], [0.25, 0.5, 0.09329195370986383], [0.25, 0.5, 0.0946828619137796], [1, 1.0, 0.09707476880425547], [0.5, 0.5, 0.09973471617819818], [0.5, 0.5, 0.09958974459711169], [0.5, 0.5, 0.0996074167664695]], [[0.1, 15, 0.015101438902596858], [1, 11, 0.043632195007558806], [0.25, 4.5, 0.0513888201987064], [0.5, 3.0, 0.07154350331294941], [0.25, 2.5, 0.0690000996423807], [0.25, 1.5, 0.09267072031693854], [0.25, 1.5, 0.0851163296569588], [0.5, 1.5, 0.09209686018822227], [0.1, 1.0, 0.09416337275467347], [0.25, 0.5, 0.11843294115559616], [0.25, 0.5, 0.12158397642374273], [0.25, 0.5, 0.1096280938186088]], [[0.1, 15, 0.026619490335662317], [0.1, 9.0, 0.050504062005151014], [0.1, 5.0, 0.0713601124927621], [0.1, 3.5, 0.08805007351137381], [0.25, 5.5, 0.07386493500472424], [0.25, 4.0, 0.09694814142068903], [0.1, 2.0, 0.12021291656308608], [0.25, 3.0, 0.11479656496723399], [0.1, 1.5, 0.13401918572292507], [0.25, 2.0, 0.1349782600671132], [0.1, 1.0, 0.14810869781345803], [0.25, 1.5, 0.14697763727077245]], [[0.75, 15, 0.03077448555866715], [0.1, 2.0, 0.07469354784786719], [0.1, 2.0, 0.07196468160088262], [0.1, 1.0, 0.09540216034773999], [0.1, 0.5, 0.10531533516906448], [0.1, 0.5, 0.10656772099564069], [0.1, 0.5, 0.12329296594894355], [0.5, 0.5, 0.12721135860615787], [0.1, 0.5, 0.11949293595720929], [1, 0.5, 0.13058436667256348], [0.75, 0.5, 0.13968395663582245], [0.1, 0.0, 0.12464415152587664]], [[0.25, 15, 0.02278261261070167], [0.25, 5.0, 0.04895615055533363], [0.1, 3.0, 0.05572831769094007], [0.25, 3.0, 0.06702446364579666], [0.25, 2.5, 0.07013730068513448], [0.25, 1.5, 0.08397721917362477], [0.25, 1.5, 0.08512130761263532], [0.25, 1.5, 0.09282191460069969], [0.25, 1.0, 0.0918618954327951], [0.25, 0.5, 0.10426189531128274], [0.1, 1.0, 0.09490479791336535], [0.25, 0.5, 0.11141959059770565]], [[0.25, 5.5, 0.037248973306756694], [0.1, 1.5, 0.06626104611602922], [0.25, 1.5, 0.07546671186679799], [0.25, 1.0, 0.08407657657126942], [0.25, 0.5, 0.09078741721271297], [0.1, 0.5, 0.08768203773277194], [0.25, 0.5, 0.10198276040290681], [0.1, 0.5, 0.08950394129223753], [0.25, 0.5, 0.09429264917381665], [0.25, 0.5, 0.10222609709129236], [0.25, 0.5, 0.09721492747486608], [0.5, 0.5, 0.10147191548742811]], [[0.1, 13, 0.021837178561675788], [0.25, 5.0, 0.059224930212378464], [0.1, 4.0, 0.04986804550049401], [0.1, 2.5, 0.06524095893816062], [0.1, 1.5, 0.07572049244501251], [0.1, 1.0, 0.09844723272110904], [0.1, 1.0, 0.09196609259721172], [0.1, 1.0, 0.09179836126346395], [0.1, 0.5, 0.09657873377924148], [0.25, 0.5, 0.11606923270709357], [0.25, 0.5, 0.12090223410190014], [0.1, 0.5, 0.11774022237165187]], [[0.1, 15, 0.018914205485892382], [0.25, 12, 0.0394283955446655], [0.1, 6.5, 0.05037380708705508], [0.1, 3.5, 0.07494314606811764], [0.1, 3.0, 0.07761232538943318], [0.1, 2.0, 0.09901857996366296], [0.25, 2.5, 0.10356808028370565], [0.1, 2.0, 0.08671545842236356], [0.1, 1.5, 0.10810156606143835], [0.1, 1.5, 0.12531006764540337], [0.1, 1.0, 0.1069445909862925], [0.1, 1.0, 0.11281226522470464]]]
airports = ["katl","kclt","kden","kdfw","kjfk","kmem","kmia","kord","kphx","ksea"]
lookahead=range(30,390,30)
b = dict()
for i in range(len(a)):
    for j in range(len(a[i])):
        if a[i][j][1] > 10:
            a[i][j][1] = 10
        b[(airports[i],lookahead[j])] = a[i][j][:2]

print(b)

def reg_hyper_output_to_key_regularized_V3(a): # combines v2 and v3. 
a = [[[0.1, 15, 0.012827107467716972], [0.1, 7.5, 0.03034380858845281], [0.1, 3.5, 0.048039959815295866], [0.25, 4.5, 0.04746820457201385], [0.1, 1.5, 0.06750003022140949], [0.1, 2.0, 0.056714218580424546], [0.25, 1.5, 0.07860435060431968], [0.1, 1.0, 0.07763039193215514], [0.1, 1.0, 0.08256280486628258], [0.1, 0.5, 0.08243858365349828], [0.1, 0.5, 0.08914492076675005], [0.1, 1.0, 0.100760812843948]], [[0.25, 14, 0.04574629385392288], [0.1, 4.5, 0.07653471045487728], [0.25, 5.0, 0.08604715882955592], [0.1, 2.5, 0.11058332070827255], [0.25, 2.0, 0.1303221574506315], [0.25, 1.5, 0.15121919448037693], [0.1, 1.0, 0.15581065682630574], [0.1, 0.5, 0.15722633952704118], [0.25, 1.0, 0.17802706314524072], [0.1, 0.5, 0.18144883501833514], [0.25, 0.5, 0.19943118618489367], [0.1, 0.5, 0.1817780184855386]], [[0.5, 12, 0.025169467472367316], [0.5, 2.0, 0.06609384178218936], [0.25, 1.5, 0.07081415930938523], [0.1, 1.0, 0.07890610065466859], [0.5, 1.0, 0.08487285089866362], [0.75, 1.0, 0.09943910050542225], [0.25, 0.5, 0.09329195370986383], [0.25, 0.5, 0.0946828619137796], [1, 1.0, 0.09707476880425547], [0.5, 0.5, 0.09973471617819818], [0.5, 0.5, 0.09958974459711169], [0.5, 0.5, 0.0996074167664695]], [[0.1, 15, 0.015101438902596858], [1, 11, 0.043632195007558806], [0.25, 4.5, 0.0513888201987064], [0.5, 3.0, 0.07154350331294941], [0.25, 2.5, 0.0690000996423807], [0.25, 1.5, 0.09267072031693854], [0.25, 1.5, 0.0851163296569588], [0.5, 1.5, 0.09209686018822227], [0.1, 1.0, 0.09416337275467347], [0.25, 0.5, 0.11843294115559616], [0.25, 0.5, 0.12158397642374273], [0.25, 0.5, 0.1096280938186088]], [[0.1, 15, 0.026619490335662317], [0.1, 9.0, 0.050504062005151014], [0.1, 5.0, 0.0713601124927621], [0.1, 3.5, 0.08805007351137381], [0.25, 5.5, 0.07386493500472424], [0.25, 4.0, 0.09694814142068903], [0.1, 2.0, 0.12021291656308608], [0.25, 3.0, 0.11479656496723399], [0.1, 1.5, 0.13401918572292507], [0.25, 2.0, 0.1349782600671132], [0.1, 1.0, 0.14810869781345803], [0.25, 1.5, 0.14697763727077245]], [[0.75, 15, 0.03077448555866715], [0.1, 2.0, 0.07469354784786719], [0.1, 2.0, 0.07196468160088262], [0.1, 1.0, 0.09540216034773999], [0.1, 0.5, 0.10531533516906448], [0.1, 0.5, 0.10656772099564069], [0.1, 0.5, 0.12329296594894355], [0.5, 0.5, 0.12721135860615787], [0.1, 0.5, 0.11949293595720929], [1, 0.5, 0.13058436667256348], [0.75, 0.5, 0.13968395663582245], [0.1, 0.0, 0.12464415152587664]], [[0.25, 15, 0.02278261261070167], [0.25, 5.0, 0.04895615055533363], [0.1, 3.0, 0.05572831769094007], [0.25, 3.0, 0.06702446364579666], [0.25, 2.5, 0.07013730068513448], [0.25, 1.5, 0.08397721917362477], [0.25, 1.5, 0.08512130761263532], [0.25, 1.5, 0.09282191460069969], [0.25, 1.0, 0.0918618954327951], [0.25, 0.5, 0.10426189531128274], [0.1, 1.0, 0.09490479791336535], [0.25, 0.5, 0.11141959059770565]], [[0.25, 5.5, 0.037248973306756694], [0.1, 1.5, 0.06626104611602922], [0.25, 1.5, 0.07546671186679799], [0.25, 1.0, 0.08407657657126942], [0.25, 0.5, 0.09078741721271297], [0.1, 0.5, 0.08768203773277194], [0.25, 0.5, 0.10198276040290681], [0.1, 0.5, 0.08950394129223753], [0.25, 0.5, 0.09429264917381665], [0.25, 0.5, 0.10222609709129236], [0.25, 0.5, 0.09721492747486608], [0.5, 0.5, 0.10147191548742811]], [[0.1, 13, 0.021837178561675788], [0.25, 5.0, 0.059224930212378464], [0.1, 4.0, 0.04986804550049401], [0.1, 2.5, 0.06524095893816062], [0.1, 1.5, 0.07572049244501251], [0.1, 1.0, 0.09844723272110904], [0.1, 1.0, 0.09196609259721172], [0.1, 1.0, 0.09179836126346395], [0.1, 0.5, 0.09657873377924148], [0.25, 0.5, 0.11606923270709357], [0.25, 0.5, 0.12090223410190014], [0.1, 0.5, 0.11774022237165187]], [[0.1, 15, 0.018914205485892382], [0.25, 12, 0.0394283955446655], [0.1, 6.5, 0.05037380708705508], [0.1, 3.5, 0.07494314606811764], [0.1, 3.0, 0.07761232538943318], [0.1, 2.0, 0.09901857996366296], [0.25, 2.5, 0.10356808028370565], [0.1, 2.0, 0.08671545842236356], [0.1, 1.5, 0.10810156606143835], [0.1, 1.5, 0.12531006764540337], [0.1, 1.0, 0.1069445909862925], [0.1, 1.0, 0.11281226522470464]]]
airports = ["katl","kclt","kden","kdfw","kjfk","kmem","kmia","kord","kphx","ksea"]
lookahead=range(30,390,30)
b = dict()
for i in range(len(a)):
    for j in range(len(a[i])):
        if a[i][j][0] < .25:
            a[i][j][0] = .25
        if a[i][j][1] > 10:
            a[i][j][1] = 10
        if a[i][j][1] < 3:
            a[i][j][1] = 3
        b[(airports[i],lookahead[j])] = a[i][j][:2]

print(b)

def getData():
    a = [(('katl', 30), 0.0221591757293933), (('katl', 60), 0.03845946366424164), (('katl', 90), 0.05125748525155117), (('katl', 120), 0.07387849925564653), (('katl', 150), 0.06203270466743236), (('katl', 180), 0.07004785431868182), (('katl', 210), 0.08683734492755381), (('katl', 240), 0.09788308775721055), (('katl', 270), 0.09066768207779778), (('katl', 300), 0.09900958705703129), (('katl', 330), 0.1056840345181752), (('katl', 360), 0.11204322758663951), (('kclt', 30), 0.04993674624892325), (('kclt', 60), 0.07881905362313378), (('kclt', 90), 0.09752921678383056), (('kclt', 120), 0.11495071648598001), (('kclt', 150), 0.1364932089981188), (('kclt', 180), 0.1714960243097542), (('kclt', 210), 0.1536629904753968), (('kclt', 240), 0.16046639053442907), (('kclt', 270), 0.17139124879212847), (('kclt', 300), 0.2181554661825516), (('kclt', 330), 0.2225630219651173), (('kclt', 360), 0.2565828771400657), (('kden', 30), 0.022941881047704372), (('kden', 60), 0.06572398891801665), (('kden', 90), 0.0753721491267919), (('kden', 120), 0.08905041996455923), (('kden', 150), 0.09591816920130687), (('kden', 180), 0.09982575052846711), (('kden', 210), 0.12216582574775703), (('kden', 240), 0.10966513894673588), (('kden', 270), 0.10450666187305678), (('kden', 300), 0.1157562834537811), (('kden', 330), 0.11657334503879316), (('kden', 360), 0.11329527052537207), (('kdfw', 30), 0.022909075338465784), (('kdfw', 60), 0.0486382945364052), (('kdfw', 90), 0.0539242556867013), (('kdfw', 120), 0.07167224142460367), (('kdfw', 150), 0.07703032765554323), (('kdfw', 180), 0.0908763764831604), (('kdfw', 210), 0.09375984988994147), (('kdfw', 240), 0.10048842997349622), (('kdfw', 270), 0.10468775703930544), (('kdfw', 300), 0.14606875667479302), (('kdfw', 330), 0.13511713654150787), (('kdfw', 360), 0.12710291472416935), (('kjfk', 30), 0.03275714275540641), (('kjfk', 60), 0.05460450709913003), (('kjfk', 90), 0.06884394497546366), (('kjfk', 120), 0.09256826796708337), (('kjfk', 150), 0.09549366057920926), (('kjfk', 180), 0.11136607306933971), (('kjfk', 210), 0.12847648029439704), (('kjfk', 240), 0.1234062115488979), (('kjfk', 270), 0.1336268601552996), (('kjfk', 300), 0.14329251082707403), (('kjfk', 330), 0.1510312540963112), (('kjfk', 360), 0.14805369183219605), (('kmem', 30), 0.03278725577317102), (('kmem', 60), 0.0755076300898919), (('kmem', 90), 0.0861673469370671), (('kmem', 120), 0.11041858002850867), (('kmem', 150), 0.11548804150375154), (('kmem', 180), 0.1434732318524344), (('kmem', 210), 0.14167332432039104), (('kmem', 240), 0.13624054428363247), (('kmem', 270), 0.13984349839761295), (('kmem', 300), 0.14964368471021455), (('kmem', 330), 0.1504689187633461), (('kmem', 360), 0.1441560971751409), (('kmia', 30), 0.02029625348374861), (('kmia', 60), 0.03655952206392513), (('kmia', 90), 0.05417693896401768), (('kmia', 120), 0.07149568538827501), (('kmia', 150), 0.06920202559342296), (('kmia', 180), 0.0875400743392576), (('kmia', 210), 0.0857722642547148), (('kmia', 240), 0.09836110703462465), (('kmia', 270), 0.11396260681134368), (('kmia', 300), 0.12810884660333857), (('kmia', 330), 0.11419121035920998), (('kmia', 360), 0.1344115024593907), (('kord', 30), 0.04240291504204448), (('kord', 60), 0.07099322731344042), (('kord', 90), 0.08388667059159968), (('kord', 120), 0.10358227415676825), (('kord', 150), 0.1039682707197005), (('kord', 180), 0.11226764905058335), (('kord', 210), 0.11245093230666414), (('kord', 240), 0.11922685465944008), (('kord', 270), 0.10714183762160524), (('kord', 300), 0.1350914155064745), (('kord', 330), 0.1143994110763065), (('kord', 360), 0.12518240136288392), (('kphx', 30), 0.025880658203463292), (('kphx', 60), 0.046064708980292704), (('kphx', 90), 0.06260061273847409), (('kphx', 120), 0.08462492298336208), (('kphx', 150), 0.08907020137349425), (('kphx', 180), 0.11129958509008395), (('kphx', 210), 0.12322101440180695), (('kphx', 240), 0.14141959286627173), (('kphx', 270), 0.15303415082584554), (('kphx', 300), 0.15029333943005546), (('kphx', 330), 0.1511209948631367), (('kphx', 360), 0.1703855101915803), (('ksea', 30), 0.0306791186352483), (('ksea', 60), 0.06387094591145262), (('ksea', 90), 0.05959734793319535), (('ksea', 120), 0.07250799781280463), (('ksea', 150), 0.08686192830036428), (('ksea', 180), 0.09883723667752724), (('ksea', 210), 0.10635249651884059), (('ksea', 240), 0.10552668863969893), (('ksea', 270), 0.10622374535247149), (('ksea', 300), 0.11184170457229822), (('ksea', 330), 0.13977470132154537), (('ksea', 360), 0.12243754085033398)]
    airports = ["katl","kclt","kden","kdfw","kjfk","kmem","kmia","kord","kphx","ksea"]
    avg = 0
    for air in airports:   
        for i in a:
            if i[0][0] = air:
                avg += i[1]
        print(avg/12)


def getChangeDist():
    airports = ["katl","kclt","kden","kdfw","kjfk","kmem","kmia","kord","kphx","ksea"]
    for airport_code in airports:
        filename = f"./data/{airport_code}/{airport_code}_airport_config.csv.bz2"
        airport_config_df = pd.read_csv(filename, parse_dates=["timestamp"])
        config_timecourse = (
            airport_config_df.set_index("timestamp")
            .airport_config
            .resample("15min")
            .ffill()
            .dropna()
        )
        first = True
        changes = [0]*int(24*60/30)
        for i in range(len(config_timecourse)):
            if not first:
                if not config_timecourse[i] == config_timecourse[i-1]:
                    time = str(config_timecourse.keys()[i]).split()[1].split(":")
                    time = (int(time[0])*60+int(time[1]))/30
                    changes[int(time)] += 1
            first = False
        i = range(int(24*60/30))
        print("Displaying")
        print("Total changes: "+str(sum(changes)))
        print(changes)